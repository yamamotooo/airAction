0
"x 0: 54.16682472543246"
1
"x 1: 88.9617437778354"
2
"x 2: 30.38683073041184"
3
"x 3: 16.8656521420114"
4
"x 4: 58.77722253993205"
5
"x 5: 24.146630044863183"
6
"x 6: 50.782396159732"
7
"x 7: 97.11388192911608"
8
"x 8: 60.05281793309207"
9
"x 9: 37.20411419772511"
10
"x 10: 37.30934362886541"
11
"x 11: 80.31250063725935"
12
"x 12: 23.998183695792243"
13
"x 13: 54.124845344271264"
14
"x 14: 92.51484686341774"
15
"x 15: 28.091374534553147"
16
"x 16: 19.449495221755576"
17
"x 17: 66.24081628448165"
18
"y 0: 69.84362290850244"
19
"y 1: 96.90848400962581"
20
"y 2: 11.401220424503244"
21
"y 3: 96.83286180155778"
22
"y 4: 89.19450461414105"
23
"y 5: 22.91733346732765"
24
"y 6: 8.211023731280974"
25
"y 7: 66.07270846402199"
26
"y 8: 83.26857284426563"
27
"y 9: 8.251718196387381"
28
"y 10: 90.3297232561558"
29
"y 11: 60.589374018455885"
30
"y 12: 30.680703938616404"
31
"y 13: 44.77840762149343"
32
"y 14: 66.94866019189104"
33
"y 15: 48.45434515936121"
34
"y 16: 64.69833596010474"
35
"y 17: 22.330946425082253"
36
"confidence 0: 94.67266698640331"
37
"confidence 1: 56.59655642614068"
38
"confidence 2: 65.60182038901047"
39
"confidence 3: 4.801548576004688"
40
"confidence 4: 10.94170693205202"
41
"confidence 5: 4.210038586023012"
42
"confidence 6: 52.64513452920762"
43
"confidence 7: 0.8342817652203793"
44
"confidence 8: 3.89894347085441"
45
"confidence 9: 62.937282433255746"
46
"confidence 10: 43.14688120498196"
47
"confidence 11: 29.425750844597697"
48
"confidence 12: 45.2388272721459"
49
"confidence 13: 44.95203139008066"
50
"confidence 14: 18.48178507826278"
51
"confidence 15: 50.60758598795203"
52
"confidence 16: 68.82461557715445"
53
"confidence 17: 87.12583712916134"
54
"x 0: 22.894877903754175"
55
"x 1: 49.234369651508366"
56
"x 2: 10.611931694414123"
57
"x 3: 51.966735214069836"
58
"x 4: 32.56738573613425"
59
"x 5: 12.925955239303944"
60
"x 6: 52.71729713877239"
61
"x 7: 11.04160805163551"
62
"x 8: 91.03318133626776"
63
"x 9: 72.07931766603748"
64
"x 10: 83.92699231328736"
65
"x 11: 37.10500649856285"
66
"x 12: 9.561303851105007"
67
"x 13: 44.96437368920454"
68
"x 14: 59.81701929851375"
69
"x 15: 74.71638888261106"
70
"x 16: 0.594609206972252"
71
"x 17: 97.44501672043823"
72
"y 0: 23.003631218598507"
73
"y 1: 34.39279149872267"
74
"y 2: 72.36443819279006"
75
"y 3: 9.101859273162994"
76
"y 4: 36.17259444841634"
77
"y 5: 63.469347373795394"
78
"y 6: 80.66185058354296"
79
"y 7: 51.455262686338145"
80
"y 8: 38.88948718049493"
81
"y 9: 54.47206373898725"
82
"y 10: 14.91533407265172"
83
"y 11: 69.5488085711274"
84
"y 12: 6.327531814024045"
85
"y 13: 16.48835726565351"
86
"y 14: 60.15104629652075"
87
"y 15: 67.92328523703141"
88
"y 16: 49.55514024580937"
89
"y 17: 71.18816087373636"
90
"confidence 0: 22.260723322963884"
91
"confidence 1: 40.140972898118974"
92
"confidence 2: 62.045786420470414"
93
"confidence 3: 76.34106671850101"
94
"confidence 4: 59.87393972361067"
95
"confidence 5: 39.353326713265034"
96
"confidence 6: 44.16500502494366"
97
"confidence 7: 21.21554869199195"
98
"confidence 8: 18.949353865774697"
99
"confidence 9: 76.31297197310403"
100
"confidence 10: 89.92102747878106"
101
"confidence 11: 24.49532562440606"
102
"confidence 12: 41.191577947298384"
103
"confidence 13: 7.07379743506642"
104
"confidence 14: 41.05664302070745"
105
"confidence 15: 44.27584487311444"
106
"confidence 16: 96.53838552633593"
107
"confidence 17: 69.86963916652286"
108
"x 0: 81.07433106540778"
109
"x 1: 91.45556018495633"
110
"x 2: 94.4756273870565"
111
"x 3: 90.95634237988952"
112
"x 4: 78.24176663062481"
113
"x 5: 30.88934575364223"
114
"x 6: 43.49699547577757"
115
"x 7: 27.901808123068616"
116
"x 8: 43.62391017268984"
117
"x 9: 11.973310317718934"
118
"x 10: 21.087158004014828"
119
"x 11: 37.23202824291698"
120
"x 12: 59.7074824358655"
121
"x 13: 21.977597182338037"
122
"x 14: 99.39818241821231"
123
"x 15: 40.549872789873945"
124
"x 16: 39.181667632648"
125
"x 17: 73.09726909734385"
126
"y 0: 43.043751265978926"
127
"y 1: 1.848651776239496"
128
"y 2: 13.112647385593256"
129
"y 3: 88.50103419742844"
130
"y 4: 96.08648476559019"
131
"y 5: 39.18755906028052"
132
"y 6: 34.438680134602016"
133
"y 7: 44.07949234581149"
134
"y 8: 96.37324032414351"
135
"y 9: 59.70474891745834"
136
"y 10: 8.626596086252281"
137
"y 11: 70.47957380588578"
138
"y 12: 44.9049742954019"
139
"y 13: 99.73058043656725"
140
"y 14: 91.48277964258085"
141
"y 15: 73.79131615205586"
142
"y 16: 38.72507149727935"
143
"y 17: 74.96397777817194"
144
"confidence 0: 26.32074164609035"
145
"confidence 1: 83.42370182292503"
146
"confidence 2: 6.662122304325058"
147
"confidence 3: 20.84061942373012"
148
"confidence 4: 17.883536331885118"
149
"confidence 5: 75.2628002582918"
150
"confidence 6: 37.18758276361789"
151
"confidence 7: 17.52456746026646"
152
"confidence 8: 2.6019394708704846"
153
"confidence 9: 8.736466768878316"
154
"confidence 10: 0.2031371159195383"
155
"confidence 11: 17.188179728151166"
156
"confidence 12: 36.63009280349725"
157
"confidence 13: 13.440369777674677"
158
"confidence 14: 85.00952732436998"
159
"confidence 15: 54.30119296825215"
160
"confidence 16: 94.49977954186163"
161
"confidence 17: 85.87225025503761"
162
"x 0: 0.460859588230611"
163
"x 1: 12.737647636247074"
164
"x 2: 33.58338255813445"
165
"x 3: 99.65923664668075"
166
"x 4: 67.33785275838527"
167
"x 5: 54.15618210194696"
168
"x 6: 37.79688583559165"
169
"x 7: 71.71312765796922"
170
"x 8: 8.41582526039909"
171
"x 9: 59.98852577335184"
172
"x 10: 87.99041719954216"
173
"x 11: 77.72196115369837"
174
"x 12: 19.53632210403503"
175
"x 13: 2.3668852169520638"
176
"x 14: 21.477302008516254"
177
"x 15: 50.503088105783"
178
"x 16: 29.150482483559216"
179
"x 17: 35.702501566409815"
180
"y 0: 9.082448325712944"
181
"y 1: 84.51976549560374"
182
"y 2: 81.81055997203146"
183
"y 3: 89.15419425774839"
184
"y 4: 99.3672210979375"
185
"y 5: 4.715863309763913"
186
"y 6: 68.13228647676318"
187
"y 7: 58.605039832464236"
188
"y 8: 72.65551912553452"
189
"y 9: 50.92486902184533"
190
"y 10: 77.83170635993073"
191
"y 11: 79.85553109678663"
192
"y 12: 94.8236008906674"
193
"y 13: 97.80724585853757"
194
"y 14: 78.1848888146329"
195
"y 15: 65.74027911634566"
196
"y 16: 1.717966261497772"
197
"y 17: 45.05641186254425"
198
"confidence 0: 72.52102806345337"
199
"confidence 1: 18.455754499928844"


// クリップボードの内容を取得
/*
// フレーム 1 の x 座標
[1
 1
 0] = nose の x 座標
[1
 1
 1] = neck の x 座標
[1
 1
 2] = right shoulder の x 座標
// ...
[1
 1
 17] = left ear の x 座標
x0
x1
x2
...
x17
y0
y1
y2
...
y17
confidence0
confidence1
confidence2
...
confidence17
*/

nose
neck
right shoulder
right elbow
right wrist
left shoulder
left elbow
left wrist
right hip
right knee
right ankle
left hip
left knee
left ankle
right eye
left eye
right ear
left ear

0 - nose
// 1 - left eye (inner)
2 - left eye
// 3 - left eye (outer)
// 4 - right eye (inner)
5 - right eye
// 6 - right eye (outer)
7 - left ear
8 - right ear
// 9 - mouth (left)
// 10 - mouth (right)
11 - left shoulder
12 - right shoulder
13 - left elbow
14 - right elbow
15 - left wrist
16 - right wrist
// 17 - left pinky
// 18 - right pinky
// 19 - left index
// 20 - right index
// x21 - left thumb
// 22 - right thumb
23 - left hip
24 - right hip
25 - left knee
26 - right knee
27 - left ankle
28 - right ankle
// 29 - left heel
// 30 - right heel
// 31 - left foot index
// 32 - right foot index



// if (lastVideoTime !== videoElement.currentTime) {
        //   lastVideoTime = videoElement.currentTime;
        //   canvasElement.width = videoElement.videoWidth;
        //   canvasElement.height = videoElement.videoHeight;
        //   canvasCtx.save();
        //   canvasCtx.clearRect(0
 0
 canvasElement.width
 canvasElement.height);        
        //   // canvasCtx.drawImage(videoElement
 0
 0
 canvasElement.width
 canvasElement.height);
        //   const centerX = canvasElement.width / 2;
        //   const centerY = canvasElement.height / 2;
        //   // キャンバスの中心を基準に移動
        //   canvasCtx.translate(centerX
 centerY);    
        //   // 回転角度を指定（90度 = Math.PI / 2）
        //   hoge = hoge + 1;    
        //   const rotationAngle = hoge * (Math.PI / 180);
        //   canvasCtx.rotate(rotationAngle);    
        //   canvasCtx.drawImage(videoElement
 -centerX
 -centerY
 canvasElement.width
 canvasElement.height);
        //   canvasCtx.restore();
        // }





// Copyright 2023 The MediaPipe Authors.

// Licensed under the Apache License
 Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing
 software
// distributed under the License is distributed on an "AS IS" BASIS

// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND
 either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import {
  PoseLandmarker

  FilesetResolver

  DrawingUtils
} from "https://cdn.skypack.dev/@mediapipe/tasks-vision@0.10.0";

const demosSection = document.getElementById("demos");

let poseLandmarker: PoseLandmarker = undefined;
let runningMode = "IMAGE";
let enableWebcamButton: HTMLButtonElement;
let webcamRunning: Boolean = false;
const videoHeight = "360px";
const videoWidth = "480px";

// Before we can use PoseLandmarker class we must wait for it to finish
// loading. Machine Learning models can be large and take a moment to
// get everything needed to run.
const createPoseLandmarker = async () => {
  const vision = await FilesetResolver.forVisionTasks(
    "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm"
  );
  poseLandmarker = await PoseLandmarker.createFromOptions(vision
 {
    baseOptions: {
      modelAssetPath: `https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task`

      delegate: "GPU"
    }

    runningMode: runningMode

    numPoses: 2
  });
  demosSection.classList.remove("invisible");
};
createPoseLandmarker();

/********************************************************************
// Demo 1: Grab a bunch of images from the page and detection them
// upon click.
********************************************************************/

// In this demo
 we have put all our clickable images in divs with the
// CSS class 'detectionOnClick'. Lets get all the elements that have
// this class.
const imageContainers = document.getElementsByClassName("detectOnClick");

// Now let's go through all of these and add a click event listener.
for (let i = 0; i < imageContainers.length; i++) {
  // Add event listener to the child element whichis the img element.
  imageContainers[i].children[0].addEventListener("click"
 handleClick);
}

// When an image is clicked
 let's detect it and display results!
async function handleClick(event) {
  if (!poseLandmarker) {
    console.log("Wait for poseLandmarker to load before clicking!");
    return;
  }

  if (runningMode === "VIDEO") {
    runningMode = "IMAGE";
    await poseLandmarker.setOptions({ runningMode: "IMAGE" });
  }
  // Remove all landmarks drawed before
  const allCanvas = event.target.parentNode.getElementsByClassName("canvas");
  for (var i = allCanvas.length - 1; i >= 0; i--) {
    const n = allCanvas[i];
    n.parentNode.removeChild(n);
  }

  // We can call poseLandmarker.detect as many times as we like with
  // different image data each time. The result is returned in a callback.
  poseLandmarker.detect(event.target
 (result) => {
    const canvas = document.createElement("canvas");
    canvas.setAttribute("class"
 "canvas");
    canvas.setAttribute("width"
 event.target.naturalWidth + "px");
    canvas.setAttribute("height"
 event.target.naturalHeight + "px");
    canvas.style =
      "left: 0px;" +
      "top: 0px;" +
      "width: " +
      event.target.width +
      "px;" +
      "height: " +
      event.target.height +
      "px;";

    event.target.parentNode.appendChild(canvas);
    const canvasCtx = canvas.getContext("2d");
    const drawingUtils = new DrawingUtils(canvasCtx);
    for (const landmark of result.landmarks) {
      drawingUtils.drawLandmarks(landmark
 {
        radius: (data) => DrawingUtils.lerp(data.from!.z
 -0.15
 0.1
 5
 1)
      });
      drawingUtils.drawConnectors(landmark
 PoseLandmarker.POSE_CONNECTIONS);
    }
  });
}

/********************************************************************
// Demo 2: Continuously grab image from webcam stream and detect it.
********************************************************************/

const video = document.getElementById("webcam") as HTMLVideoElement;
const canvasElement = document.getElementById(
  "output_canvas"
) as HTMLCanvasElement;
const canvasCtx = canvasElement.getContext("2d");
const drawingUtils = new DrawingUtils(canvasCtx);

// Check if webcam access is supported.
const hasGetUserMedia = () => !!navigator.mediaDevices?.getUserMedia;

// If webcam supported
 add event listener to button for when user
// wants to activate it.
if (hasGetUserMedia()) {
  enableWebcamButton = document.getElementById("webcamButton");
  enableWebcamButton.addEventListener("click"
 enableCam);
} else {
  console.warn("getUserMedia() is not supported by your browser");
}

// Enable the live webcam view and start detection.
function enableCam(event) {
  if (!poseLandmarker) {
    console.log("Wait! poseLandmaker not loaded yet.");
    return;
  }

  if (webcamRunning === true) {
    webcamRunning = false;
    enableWebcamButton.innerText = "ENABLE PREDICTIONS";
  } else {
    webcamRunning = true;
    enableWebcamButton.innerText = "DISABLE PREDICTIONS";
  }

  // getUsermedia parameters.
  const constraints = {
    video: true
  };

  // Activate the webcam stream.
  navigator.mediaDevices.getUserMedia(constraints).then((stream) => {
    video.srcObject = stream;
    video.addEventListener("loadeddata"
 predictWebcam);
  });
}

let lastVideoTime = -1;
async function predictWebcam() {
  canvasElement.style.height = videoHeight;
  video.style.height = videoHeight;
  canvasElement.style.width = videoWidth;
  video.style.width = videoWidth;
  // Now let's start detecting the stream.
  if (runningMode === "IMAGE") {
    runningMode = "VIDEO";
    await poseLandmarker.setOptions({ runningMode: "VIDEO" });
  }
  let startTimeMs = performance.now();
  if (lastVideoTime !== video.currentTime) {
    lastVideoTime = video.currentTime;
    poseLandmarker.detectForVideo(video
 startTimeMs
 (result) => {
      canvasCtx.save();
      canvasCtx.clearRect(0
 0
 canvasElement.width
 canvasElement.height);
      for (const landmark of result.landmarks) {
        drawingUtils.drawLandmarks(landmark
 {
          radius: (data) => DrawingUtils.lerp(data.from!.z
 -0.15
 0.1
 5
 1)
        });
        drawingUtils.drawConnectors(landmark
 PoseLandmarker.POSE_CONNECTIONS);
      }
      canvasCtx.restore();
    });
  }

  // Call this function again to keep predicting when the browser is ready.
  if (webcamRunning === true) {
    window.requestAnimationFrame(predictWebcam);
  }
}
